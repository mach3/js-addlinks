/*
 * AddLinks
 * Copyright (C) Matsukaze. All rights reserved.
 * @version 1.0
 * @require jQuery 1.4 or later
 * @author mach3
 */
var AddLinks=function(b,a){this.links=a||[];if(b){this.config(b)}return this};AddLinks.prototype={EVENT_CHANGE:"change",EVENT_ERROR:"error",ERROR_EMPTY:"empty",ERROR_LIMIT_OVER:"limitOver",ERROR_DOUBLED:"doubled",option:{urlInput:"#addLinksUrlInput",titleInput:"#addLinksTitleInput",addButton:"#addLinksAddButton",clearButton:"#addLinksClearButton",linkList:"#addLinksList",deleteButton:"#addLinksList .delete",limit:10},links:[],urlInput:null,titleInput:null,config:function(a){this.option=$.extend({},this.option,a)},run:function(){this.urlInput=$(this.option.urlInput);this.titleInput=$(this.option.titleInput);this.urlInput.bind("keydown",$.proxy(this._onKeyDownInput,this));this.titleInput.bind("keydown",$.proxy(this._onKeyDownInput,this));$(this.option.addButton).click($.proxy(this._onClickAddButton,this));$(this.option.clearButton).click($.proxy(this.clear,this));$(this.option.deleteButton).live("click",$.proxy(this._onClickDeleteButton,this));$(this).bind(this.EVENT_CHANGE,$.proxy(this.refreshList,this));return this},_onKeyDownInput:function(a){if(a.keyCode!==13){return}this._onClickAddButton()},_onClickAddButton:function(a){this.add(this.urlInput.val(),this.titleInput.val())},_onClickDeleteButton:function(a){this.removeByUrl(this._escape($(a.target).data("url")))},_error:function(a){$(this).trigger(this.EVENT_ERROR,a);return this},_escape:function(a){return $("<span>").text(a).html()},_find:function(a){var b=false;$.each(this.links,function(c,d){if(d.url===a){b=true;return false}});return b},add:function(a,b){switch(true){case (!a||!b):this._error(this.ERROR_EMPTY);return false;break;case (this.links.length>=this.option.limit):this._error(this.ERROR_LIMIT_OVER);return false;break;case (this._find(a)):this._error(this.ERROR_DOUBLED);return false;break;default:this.links.push({url:this._escape(this.urlInput.val()),title:this._escape(this.titleInput.val())});$(this).trigger(this.EVENT_CHANGE);this.urlInput.val("");this.titleInput.val("");return true;break}return false},removeByUrl:function(a){this.links=$.grep(this.links,function(c,b){return c.url!==a});$(this).trigger(this.EVENT_CHANGE);return this},clear:function(){this.links=[];$(this).trigger(this.EVENT_CHANGE);return this},refreshList:function(){var b=$(this.option.linkList),a='<li><a href="{{url}}">{{title}}</a> <input type="button" class="delete" value="X" data-url="{{url}}" /></li>';b.html("");$.each(this.links,function(d,e){var c=a.replace(/{{title}}/g,e.title).replace(/{{url}}/g,e.url);$(c).appendTo(b)});return this},bind:function(a,b){$(this).bind(a,b);return this},toString:function(){var a="[";$.each(this.links,function(b,c){if(!!b){a+=","}a+='{"url":"{{url}}","title":"{{title}}"}'.replace("{{url}}",c.url).replace("{{title}}",c.title)});a+="]";return a}};